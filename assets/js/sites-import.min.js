!function(a){"use strict";var s={currentGridFilters:{},currentPreviewInfo:{},$currentPreview:null,$container:a(".suki-sites-import-wrap"),init:function(){s.initBinds(),s.loadSiteFilters()},initBinds:function(){s.$container.on("click",".wp-filter .suki-sites-import-builders-filter a",s.clickBuilderFilter),s.$container.on("click",".wp-filter .suki-sites-import-categories-filter a",s.clickCategoryFilter),s.$container.on("keyup",".wp-filter .wp-filter-search",s.submitSearchFilter),s.$container.on("click",".theme-screenshot, .more-details",s.openSitePreview),s.$container.on("click",".close-full-overlay",s.closeSitePreview),s.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="not_installed"]',s.clickInstallPlugin),s.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="inactive"]',s.clickActivatePlugin),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="upgrade_required"]',s.clickUpgrade),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="ready_to_import"]',s.clickImport),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="finished"]',s.clickVisitSite)},loadSiteFilters:function(){a("body").addClass("loading-content"),a.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"site_filters/",cache:!1}).done(function(t,i,e){var r=s.$container.find(".wp-filter"),n=wp.template("suki-sites-import-filters");r.append(n(t)),a("body").removeClass("loading-content"),s.showBuilderSelector()})},showBuilderSelector:function(){s.$container.find(".theme-browser").html(wp.template("suki-sites-import-select-builder"))},resetSitesGrid:function(){s.$container.find(".theme-browser").empty()},loadSitesGrid:function(){s.resetSitesGrid(),a("body").addClass("loading-content");var t=a.extend({builder:null,category:null,search:null,page:1,license_key:SukiSitesImportScriptsData.license_key},s.currentGridFilters),e="";a.each(t,function(t,i){null!==i&&""!==i&&(e+="&"+t+"="+i)}),e=e.replace("&","?"),a.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"sites/"+e,cache:!1}).done(function(t,i,e){var r,n=s.$container.find(".theme-browser");r=0<t.length?wp.template("suki-sites-import-grid"):wp.template("suki-sites-import-no-site-found"),n.html(r(t)),a("body").removeClass("loading-content")})},changePluginButtonStatus:function(t,i){t.status=i;var e,r,n=s.$currentPreview.find('.suki-sites-import-preview-required-plugin-button[data-slug="'+t.slug+'"]'),a=SukiSitesImportScriptsData.strings["plugin_"+i];switch(i){case"not_installed":case"inactive":e=!1,r="button-secondary";break;case"installing":case"activating":e=!0,r="button-secondary installing disabled";break;case"active":e=!0,r="button-link updated-message disabled"}n.html(a),n.prop("disabled",e),n.removeClass("button-primary button-secondary button-link installing updated-message disabled"),n.addClass(r),n.attr("data-status",i),s.isReadyToImport()?s.changeActionButtonStatus("ready_to_import"):s.changeActionButtonStatus("plugins_not_active")},isReadyToImport:function(){var e=!0;return a.each(s.currentPreviewInfo.required_plugins,function(t,i){e=e&&"active"===i.status}),e},changeActionButtonStatus:function(t){s.currentPreviewInfo.import_status=t;var i,e,r=s.$currentPreview.find(".suki-sites-import-preview-action-button"),n=SukiSitesImportScriptsData.strings["action_"+t];switch(t){case"upgrade_required":i=!1,e="button-secondary";break;case"plugins_not_active":case"action_finished":i=!0,e="button-secondary disabled";break;case"ready_to_import":i=!1,e="button-primary";break;case"importing_contents":case"importing_customizer":case"importing_widgets":case"importing_options":i=!0,e="button-secondary installing disabled";break;case"finished":i=!1,e="button-primary updated-message"}r.html(n),r.prop("disabled",i),r.removeClass("button-primary button-secondary button-link installing updated-message disabled"),r.addClass(e),r.attr("data-status",t)},installPlugin:function(r){if("not_installed"===r.status){var n=s.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),s.changePluginButtonStatus(r,"installing"),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__install_plugin",cache:!1,data:{action:"suki_sites_import__install_plugin",plugin_slug:r.slug,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(s.changePluginButtonStatus(r,"inactive"),n.prop("disabled",!1),s.activatePlugin(r)):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},activatePlugin:function(r){if("inactive"===r.status){var n=s.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),s.changePluginButtonStatus(r,"activating"),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__activate_plugin",cache:!1,data:{action:"suki_sites_import__activate_plugin",plugin_path:r.path,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(n.prop("disabled",!1),s.changePluginButtonStatus(r,"active")):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},import:function(){if(confirm(SukiSitesImportScriptsData.strings.confirm_import))if(s.isReadyToImport()){var r="Fetching site data for last validation.";console.log(r);var t=a.extend({license_key:SukiSitesImportScriptsData.license_key},s.currentGridFilters),e="";a.each(t,function(t,i){null!==i&&""!==i&&(e+="&"+t+"="+i)}),e=e.replace("&","?"),a.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"sites/"+s.currentPreviewInfo.id+"/"+e,cache:!1}).done(function(t,i,e){i?s.importContents():alert("Error: "+r+"\n"+t.data)})}else alert(SukiSitesImportScriptsData.strings.import_error_invalid)},importContents:function(){var r="Importing content and media files";console.log(r),s.changeActionButtonStatus("importing_contents"),window.addEventListener("beforeunload",s.confirmTabClosing),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_contents",cache:!1,data:{action:"suki_sites_import__import_contents",contents_xml_file_url:s.currentPreviewInfo.contents_xml_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?s.importCustomizer():alert("Error: "+r+"\n"+t.data)})},importCustomizer:function(){var r="Importing customizer settings";console.log(r),s.changeActionButtonStatus("importing_customizer"),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_customizer",cache:!1,data:{action:"suki_sites_import__import_customizer",customizer_json_file_url:s.currentPreviewInfo.customizer_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?s.importWidgets():alert("Error: "+r+"\n"+t.data)})},importWidgets:function(){var r="Importing widgets";console.log(r),s.changeActionButtonStatus("importing_widgets"),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_widgets",cache:!1,data:{action:"suki_sites_import__import_widgets",widgets_json_file_url:s.currentPreviewInfo.widgets_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?s.importOptions():alert("Error: "+r+"\n"+t.data)})},importOptions:function(){var r="Importing other options";console.log(r),s.changeActionButtonStatus("importing_options"),a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_options",cache:!1,data:{action:"suki_sites_import__import_options",options_json_file_url:s.currentPreviewInfo.options_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(s.changeActionButtonStatus("finished"),window.removeEventListener("beforeunload",s.confirmTabClosing)):alert("Error: "+r+"\n"+t.data)})},clickBuilderFilter:function(t){t.preventDefault();var i=a(this),e=a(".suki-sites-import-builders-filter a"),r=i.attr("data-id");i.hasClass("current")||(e.removeClass("current"),i.addClass("current"),s.currentGridFilters.builder=r,s.loadSitesGrid())},clickCategoryFilter:function(t){t.preventDefault();var i=a(this),e=a(".suki-sites-import-categories-filter a"),r=a(".wp-filter-search"),n=i.attr("data-id");i.hasClass("current")||(e.removeClass("current"),i.addClass("current"),r.val(""),s.currentGridFilters.search=null,s.currentGridFilters.category="-1"===n?null:n,void 0!==s.currentGridFilters.builder&&s.loadSitesGrid())},submitSearchFilter:function(t){t.preventDefault();var i=a(this),e=a(".suki-sites-import-categories-filter a"),r=i.val();0<r.length?(e.removeClass("current"),s.currentGridFilters.search=r):(e.filter('[data-id="-1"]').addClass("current"),s.currentGridFilters.search=null),s.currentGridFilters.category=null,void 0!==s.currentGridFilters.builder&&s.loadSitesGrid()},openSitePreview:function(t){t.preventDefault();var i=a(this).closest(".theme"),e=JSON.parse(i.attr("data-info")),r=wp.template("suki-sites-import-preview");switch(s.$currentPreview=a(r(e)),s.$container.append(s.$currentPreview),s.currentPreviewInfo=e,s.currentPreviewInfo.import_status=null,s.currentPreviewInfo.status){case"require_higher_license_plan":s.changeActionButtonStatus("upgrade_required");break;default:if(0<s.currentPreviewInfo.required_plugins.length){a.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__get_plugins_status",cache:!1,data:{action:"suki_sites_import__get_plugins_status",plugins:e.required_plugins,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?a.each(t.data,function(t,i){s.changePluginButtonStatus(s.currentPreviewInfo.required_plugins[t],i)}):alert(SukiSitesImportScriptsData.strings.site_error_invalid)})}else s.changeActionButtonStatus("ready_to_import")}},closeSitePreview:function(t){t.preventDefault();var i=!0;-1<["importing_contents","importing_customizer","importing_widgets","importing_options"].indexOf(s.currentPreviewInfo.import_status)&&(confirm(SukiSitesImportScriptsData.strings.confirm_close_importing)||(i=!1)),i&&(s.$currentPreview=null,s.currentPreviewInfo={},a(".suki-sites-import-preview").remove())},clickInstallPlugin:function(t){t.preventDefault();var i=a(this).attr("data-index"),e=s.currentPreviewInfo.required_plugins[i];s.installPlugin(e)},clickActivatePlugin:function(t){t.preventDefault();var i=a(this).attr("data-index"),e=s.currentPreviewInfo.required_plugins[i];s.activatePlugin(e)},clickImport:function(t){t.preventDefault(),s.import()},clickUpgrade:function(t){window.open("https://sukiwp.com/pricing/?utm_source=suki-sites-import&utm_medium=demo-site-preview&utm_campaign=upgrade-license")},clickVisitSite:function(t){t.preventDefault(),window.location=SukiSitesImportScriptsData.home_url},confirmTabClosing:function(t){t.returnValue=""}};a(function(){s.init()})}(jQuery);