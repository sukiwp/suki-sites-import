!function(n){"use strict";var s={currentGridFilters:{},currentPreviewInfo:{},$currentPreview:null,$container:n(".suki-sites-import-wrap"),$filters:n(".suki-sites-import-wrap .wp-filter"),$browser:n(".suki-sites-import-wrap .theme-browser"),$grid:n(".suki-sites-import-wrap .themes"),templates:{selectBuilder:wp.template("suki-sites-import-select-builder"),filters:wp.template("suki-sites-import-filters"),gridItems:wp.template("suki-sites-import-grid-items"),noSiteFound:wp.template("suki-sites-import-no-site-found"),preview:wp.template("suki-sites-import-preview"),loadMore:wp.template("suki-sites-import-load-more")},init:function(){s.initBinds(),s.loadSiteFilters()},initBinds:function(){s.$container.on("click",".wp-filter .suki-sites-import-builders-filter a",s.clickBuilderFilter),s.$container.on("click",".wp-filter .suki-sites-import-categories-filter a",s.clickCategoryFilter),s.$container.on("keyup",".wp-filter .wp-filter-search",s.submitSearchFilter),s.$container.on("click",".suki-sites-import-load-more button",s.clickLoadMore),s.$container.on("click",".theme-screenshot, .more-details",s.openSitePreview),s.$container.on("click",".close-full-overlay",s.closeSitePreview),s.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="not_installed"]',s.clickInstallPlugin),s.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="inactive"]',s.clickActivatePlugin),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="upgrade_required"]',s.clickUpgrade),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="ready_to_import"]',s.clickImport),s.$container.on("click",'.suki-sites-import-preview-action-button[data-status="finished"]',s.clickVisitSite)},loadSiteFilters:function(){n("body").addClass("loading-content"),n.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"site_filters/",cache:!1}).done(function(t,e,i){s.$filters.append(s.templates.filters(t)),n("body").removeClass("loading-content");var r=s.$filters.find('.suki-sites-import-builders-filter a[data-id="'+SukiSitesImportScriptsData.selected_builder+'"]');0<r.length?(r.addClass("current"),s.currentGridFilters.builder=SukiSitesImportScriptsData.selected_builder,s.currentGridFilters.page=1,s.loadSitesGrid(!0)):s.showBuilderSelector()})},showBuilderSelector:function(){s.$grid.html(s.templates.selectBuilder())},resetSitesGrid:function(){s.$grid.empty()},loadSitesGrid:function(r){n("body").addClass("loading-content"),r&&s.resetSitesGrid();var t=n.extend({builder:null,category:null,search:null,page:1,per_page:15,license_key:SukiSitesImportScriptsData.license_key},s.currentGridFilters);SukiSitesImportScriptsData.demo_status&&(t.demo_status=SukiSitesImportScriptsData.demo_status),0<(e=s.$container.find(".suki-sites-import-load-more")).length&&e.remove();var e,i="";n.each(t,function(t,e){null!==e&&""!==e&&(i+="&"+t+"="+e)}),i=i.replace("&","?"),0<(e=s.$browser.find(".suki-sites-load-more")).length&&e.remove(),n.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+i,cache:!1}).done(function(t,e,i){s.$grid.append(s.templates.gridItems(t)),0<t.length?s.$browser.append(s.templates.loadMore()):r&&s.$grid.append(s.templates.noSiteFound()),n("body").removeClass("loading-content")})},changePluginButtonStatus:function(t,e){t.status=e;var i,r,a=s.$currentPreview.find('.suki-sites-import-preview-required-plugin-button[data-slug="'+t.slug+'"]'),n=SukiSitesImportScriptsData.strings["plugin_"+e];switch(e){case"not_installed":case"inactive":i=!1,r="button-secondary";break;case"installing":case"activating":i=!0,r="button-secondary installing disabled";break;case"active":i=!0,r="button-link updated-message disabled"}a.html(n),a.prop("disabled",i),a.removeClass("button-primary button-secondary button-link installing updated-message disabled"),a.addClass(r),a.attr("data-status",e),s.isReadyToImport()?s.changeActionButtonStatus("ready_to_import"):s.changeActionButtonStatus("plugins_not_active")},isReadyToImport:function(){var i=!0;return n.each(s.currentPreviewInfo.required_plugins,function(t,e){i=i&&"active"===e.status}),i},changeActionButtonStatus:function(t){s.currentPreviewInfo.import_status=t;var e,i,r=s.$currentPreview.find(".suki-sites-import-preview-action-button"),a=SukiSitesImportScriptsData.strings["action_"+t];switch(t){case"upgrade_required":e=!1,i="button-secondary";break;case"plugins_not_active":case"action_finished":e=!0,i="button-secondary disabled";break;case"ready_to_import":e=!1,i="button-primary";break;case"activating_pro_modules":case"importing_contents":case"importing_customizer":case"importing_widgets":case"importing_options":e=!0,i="button-secondary installing disabled";break;case"finished":e=!1,i="button-primary updated-message"}r.html(a),r.prop("disabled",e),r.removeClass("button-primary button-secondary button-link installing updated-message disabled"),r.addClass(i),r.attr("data-status",t)},installPlugin:function(r){if("not_installed"===r.status){var t="Installing plugin: "+r.name;console.log(t);var a=s.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return a.prop("disabled",!0),s.changePluginButtonStatus(r,"installing"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__install_plugin",cache:!1,data:{action:"suki_sites_import__install_plugin",plugin_slug:r.slug,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?(s.changePluginButtonStatus(r,"inactive"),a.prop("disabled",!1),s.activatePlugin(r)):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},activatePlugin:function(r){if("inactive"===r.status){var t="Activating plugin: "+r.name;console.log(t);var a=s.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return a.prop("disabled",!0),s.changePluginButtonStatus(r,"activating"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__activate_plugin",cache:!1,data:{action:"suki_sites_import__activate_plugin",plugin_path:r.path,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?(a.prop("disabled",!1),s.changePluginButtonStatus(r,"active")):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},import:function(){if(confirm(SukiSitesImportScriptsData.strings.confirm_import))if(s.isReadyToImport()){var r="Fetching site data for last validation.";console.log(r),s.changeActionButtonStatus("validating_data"),window.addEventListener("beforeunload",s.confirmTabClosing);var t=n.extend({license_key:SukiSitesImportScriptsData.license_key},s.currentGridFilters);SukiSitesImportScriptsData.demo_status&&(t.demo_status=SukiSitesImportScriptsData.demo_status);var i="";n.each(t,function(t,e){null!==e&&""!==e&&(i+="&"+t+"="+e)}),i=i.replace("&","?"),n.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+s.currentPreviewInfo.id+"/"+i,cache:!1}).done(function(t,e,i){e?s.activateProModules():alert("Error: "+r+"\n"+t.data)})}else alert(SukiSitesImportScriptsData.strings.import_error_invalid)},activateProModules:function(){var r="Activating required Suki Pro modules.";console.log(r),0<s.currentPreviewInfo.required_pro_modules.length?(s.changeActionButtonStatus("activating_pro_modules"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__activate_pro_modules",cache:!1,data:{action:"suki_sites_import__activate_pro_modules",pro_modules:s.currentPreviewInfo.required_pro_modules,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){e?s.importContents():alert("Error: "+r+"\n"+t.data)})):s.importContents()},importContents:function(){var r="Importing content and media files";console.log(r),s.changeActionButtonStatus("importing_contents"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_contents",cache:!1,data:{action:"suki_sites_import__import_contents",contents_xml_file_url:s.currentPreviewInfo.contents_xml_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?s.importCustomizer():alert("Error: "+r+"\n"+t.data)})},importCustomizer:function(){var r="Importing customizer settings";console.log(r),s.changeActionButtonStatus("importing_customizer"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_customizer",cache:!1,data:{action:"suki_sites_import__import_customizer",customizer_json_file_url:s.currentPreviewInfo.customizer_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?s.importWidgets():alert("Error: "+r+"\n"+t.data)})},importWidgets:function(){var r="Importing widgets";console.log(r),s.changeActionButtonStatus("importing_widgets"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_widgets",cache:!1,data:{action:"suki_sites_import__import_widgets",widgets_json_file_url:s.currentPreviewInfo.widgets_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?s.importOptions():alert("Error: "+r+"\n"+t.data)})},importOptions:function(){var r="Importing other options";console.log(r),s.changeActionButtonStatus("importing_options"),n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_options",cache:!1,data:{action:"suki_sites_import__import_options",options_json_file_url:s.currentPreviewInfo.options_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?(s.changeActionButtonStatus("finished"),window.removeEventListener("beforeunload",s.confirmTabClosing)):alert("Error: "+r+"\n"+t.data)})},clickBuilderFilter:function(t){t.preventDefault();var e=n(this),i=n(".suki-sites-import-builders-filter a"),r=parseInt(e.attr("data-id"));e.hasClass("current")||(i.removeClass("current"),e.addClass("current"),s.currentGridFilters.builder=r,s.currentGridFilters.page=1,n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__select_builder",cache:!1,data:{action:"suki_sites_import__select_builder",builder:r,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success||alert("Error: "+log+"\n"+t.data)}),s.loadSitesGrid(!0))},clickCategoryFilter:function(t){t.preventDefault();var e=n(this),i=n(".suki-sites-import-categories-filter a"),r=n(".wp-filter-search"),a=parseInt(e.attr("data-id"));e.hasClass("current")||(i.removeClass("current"),e.addClass("current"),r.val(""),delete s.currentGridFilters.search,-1===a?delete s.currentGridFilters.category:s.currentGridFilters.category=a,s.currentGridFilters.page=1,void 0!==s.currentGridFilters.builder&&s.loadSitesGrid(!0))},submitSearchFilter:function(t){t.preventDefault();var e=n(this),i=n(".suki-sites-import-categories-filter a"),r=e.val();0<r.length?(i.removeClass("current"),s.currentGridFilters.search=r):(i.filter('[data-id="-1"]').addClass("current"),delete s.currentGridFilters.search),delete s.currentGridFilters.category,s.currentGridFilters.page=1,void 0!==s.currentGridFilters.builder&&s.loadSitesGrid(!0)},clickLoadMore:function(t){t.preventDefault(),s.currentGridFilters.page=s.currentGridFilters.page+1,s.$browser.find(".suki-sites-load-more").remove(),s.loadSitesGrid()},openSitePreview:function(t){t.preventDefault();var e=n(this).closest(".theme"),i=JSON.parse(e.attr("data-info"));switch(s.$currentPreview=n(s.templates.preview(i)),s.$container.append(s.$currentPreview),s.currentPreviewInfo=i,s.currentPreviewInfo.import_status=null,s.currentPreviewInfo.status){case"require_higher_license_plan":s.changeActionButtonStatus("upgrade_required");break;default:if(0<s.currentPreviewInfo.required_plugins.length){n.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__get_plugins_status",cache:!1,data:{action:"suki_sites_import__get_plugins_status",plugins:i.required_plugins,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,e,i){t.success?n.each(t.data,function(t,e){s.changePluginButtonStatus(s.currentPreviewInfo.required_plugins[t],e)}):alert(SukiSitesImportScriptsData.strings.site_error_invalid)})}else s.changeActionButtonStatus("ready_to_import")}},closeSitePreview:function(t){t.preventDefault();var e=!0;-1<["importing_contents","importing_customizer","importing_widgets","importing_options"].indexOf(s.currentPreviewInfo.import_status)&&(confirm(SukiSitesImportScriptsData.strings.confirm_close_importing)||(e=!1)),e&&(s.$currentPreview=null,s.currentPreviewInfo={},n(".suki-sites-import-preview").remove())},clickInstallPlugin:function(t){t.preventDefault();var e=n(this).attr("data-index"),i=s.currentPreviewInfo.required_plugins[e];s.installPlugin(i)},clickActivatePlugin:function(t){t.preventDefault();var e=n(this).attr("data-index"),i=s.currentPreviewInfo.required_plugins[e];s.activatePlugin(i)},clickImport:function(t){t.preventDefault(),s.import()},clickUpgrade:function(t){window.open("https://sukiwp.com/pricing/?utm_source=suki-sites-import&utm_medium=demo-site-preview&utm_campaign=upgrade-license")},clickVisitSite:function(t){t.preventDefault(),window.location=SukiSitesImportScriptsData.home_url},confirmTabClosing:function(t){t.returnValue=""}};n(function(){s.init()})}(jQuery);