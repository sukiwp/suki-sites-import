!function(s){"use strict";var a={currentGridFilters:{},currentPreviewInfo:{},$currentPreview:null,$container:s(".suki-sites-import-wrap"),$filters:s(".suki-sites-import-wrap .wp-filter"),$browser:s(".suki-sites-import-wrap .theme-browser"),$grid:s(".suki-sites-import-wrap .themes"),templates:{selectBuilder:wp.template("suki-sites-import-select-builder"),filters:wp.template("suki-sites-import-filters"),gridItems:wp.template("suki-sites-import-grid-items"),noSiteFound:wp.template("suki-sites-import-no-site-found"),preview:wp.template("suki-sites-import-preview"),loadMore:wp.template("suki-sites-import-load-more")},init:function(){a.initBinds(),a.loadSiteFilters()},initBinds:function(){a.$container.on("click",".wp-filter .suki-sites-import-builders-filter a",a.clickBuilderFilter),a.$container.on("click",".wp-filter .suki-sites-import-categories-filter a",a.clickCategoryFilter),a.$container.on("keyup",".wp-filter .wp-filter-search",a.submitSearchFilter),a.$container.on("click",".suki-sites-import-load-more button",a.clickLoadMore),a.$container.on("click",".theme-screenshot, .more-details",a.openSitePreview),a.$container.on("click",".close-full-overlay",a.closeSitePreview),a.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="not_installed"]',a.clickInstallPlugin),a.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="inactive"]',a.clickActivatePlugin),a.$container.on("click",'.suki-sites-import-preview-action-button[data-status="upgrade_required"]',a.clickUpgrade),a.$container.on("click",'.suki-sites-import-preview-action-button[data-status="ready_to_import"]',a.clickImport),a.$container.on("click",'.suki-sites-import-preview-action-button[data-status="finished"]',a.clickVisitSite)},loadSiteFilters:function(){s("body").addClass("loading-content"),s.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"site_filters/",cache:!1}).done(function(t,i,e){a.$filters.append(a.templates.filters(t)),s("body").removeClass("loading-content"),a.showBuilderSelector()})},showBuilderSelector:function(){a.$grid.html(a.templates.selectBuilder())},resetSitesGrid:function(){a.$grid.empty()},loadSitesGrid:function(r){s("body").addClass("loading-content"),r&&a.resetSitesGrid();var t=s.extend({builder:null,category:null,search:null,page:1,per_page:15,license_key:SukiSitesImportScriptsData.license_key},a.currentGridFilters);0<(i=a.$container.find(".suki-sites-import-load-more")).length&&i.remove();var i,e="";s.each(t,function(t,i){null!==i&&""!==i&&(e+="&"+t+"="+i)}),e=e.replace("&","?"),0<(i=a.$browser.find(".suki-sites-load-more")).length&&i.remove(),s.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"sites/"+e,cache:!1}).done(function(t,i,e){a.$grid.append(a.templates.gridItems(t)),0<t.length?a.$browser.append(a.templates.loadMore()):r&&a.$grid.append(a.templates.noSiteFound()),s("body").removeClass("loading-content")})},changePluginButtonStatus:function(t,i){t.status=i;var e,r,n=a.$currentPreview.find('.suki-sites-import-preview-required-plugin-button[data-slug="'+t.slug+'"]'),s=SukiSitesImportScriptsData.strings["plugin_"+i];switch(i){case"not_installed":case"inactive":e=!1,r="button-secondary";break;case"installing":case"activating":e=!0,r="button-secondary installing disabled";break;case"active":e=!0,r="button-link updated-message disabled"}n.html(s),n.prop("disabled",e),n.removeClass("button-primary button-secondary button-link installing updated-message disabled"),n.addClass(r),n.attr("data-status",i),a.isReadyToImport()?a.changeActionButtonStatus("ready_to_import"):a.changeActionButtonStatus("plugins_not_active")},isReadyToImport:function(){var e=!0;return s.each(a.currentPreviewInfo.required_plugins,function(t,i){e=e&&"active"===i.status}),e},changeActionButtonStatus:function(t){a.currentPreviewInfo.import_status=t;var i,e,r=a.$currentPreview.find(".suki-sites-import-preview-action-button"),n=SukiSitesImportScriptsData.strings["action_"+t];switch(t){case"upgrade_required":i=!1,e="button-secondary";break;case"plugins_not_active":case"action_finished":i=!0,e="button-secondary disabled";break;case"ready_to_import":i=!1,e="button-primary";break;case"importing_contents":case"importing_customizer":case"importing_widgets":case"importing_options":i=!0,e="button-secondary installing disabled";break;case"finished":i=!1,e="button-primary updated-message"}r.html(n),r.prop("disabled",i),r.removeClass("button-primary button-secondary button-link installing updated-message disabled"),r.addClass(e),r.attr("data-status",t)},installPlugin:function(r){if("not_installed"===r.status){var t="Installing plugin: "+r.name;console.log(t);var n=a.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),a.changePluginButtonStatus(r,"installing"),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__install_plugin",cache:!1,data:{action:"suki_sites_import__install_plugin",plugin_slug:r.slug,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(a.changePluginButtonStatus(r,"inactive"),n.prop("disabled",!1),a.activatePlugin(r)):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},activatePlugin:function(r){if("inactive"===r.status){var t="Activating plugin: "+r.name;console.log(t);var n=a.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),a.changePluginButtonStatus(r,"activating"),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__activate_plugin",cache:!1,data:{action:"suki_sites_import__activate_plugin",plugin_path:r.path,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(n.prop("disabled",!1),a.changePluginButtonStatus(r,"active")):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},import:function(){if(confirm(SukiSitesImportScriptsData.strings.confirm_import))if(a.isReadyToImport()){var r="Fetching site data for last validation.";console.log(r);var t=s.extend({license_key:SukiSitesImportScriptsData.license_key},a.currentGridFilters),e="";s.each(t,function(t,i){null!==i&&""!==i&&(e+="&"+t+"="+i)}),e=e.replace("&","?"),s.ajax({method:"GET",url:SukiSitesImportScriptsData.api_url+"sites/"+a.currentPreviewInfo.id+"/"+e,cache:!1}).done(function(t,i,e){i?a.importContents():alert("Error: "+r+"\n"+t.data)})}else alert(SukiSitesImportScriptsData.strings.import_error_invalid)},importContents:function(){var r="Importing content and media files";console.log(r),a.changeActionButtonStatus("importing_contents"),window.addEventListener("beforeunload",a.confirmTabClosing),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_contents",cache:!1,data:{action:"suki_sites_import__import_contents",contents_xml_file_url:a.currentPreviewInfo.contents_xml_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?a.importCustomizer():alert("Error: "+r+"\n"+t.data)})},importCustomizer:function(){var r="Importing customizer settings";console.log(r),a.changeActionButtonStatus("importing_customizer"),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_customizer",cache:!1,data:{action:"suki_sites_import__import_customizer",customizer_json_file_url:a.currentPreviewInfo.customizer_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?a.importWidgets():alert("Error: "+r+"\n"+t.data)})},importWidgets:function(){var r="Importing widgets";console.log(r),a.changeActionButtonStatus("importing_widgets"),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_widgets",cache:!1,data:{action:"suki_sites_import__import_widgets",widgets_json_file_url:a.currentPreviewInfo.widgets_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?a.importOptions():alert("Error: "+r+"\n"+t.data)})},importOptions:function(){var r="Importing other options";console.log(r),a.changeActionButtonStatus("importing_options"),s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__import_options",cache:!1,data:{action:"suki_sites_import__import_options",options_json_file_url:a.currentPreviewInfo.options_json_file_url,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?(a.changeActionButtonStatus("finished"),window.removeEventListener("beforeunload",a.confirmTabClosing)):alert("Error: "+r+"\n"+t.data)})},clickBuilderFilter:function(t){t.preventDefault();var i=s(this),e=s(".suki-sites-import-builders-filter a"),r=parseInt(i.attr("data-id"));i.hasClass("current")||(e.removeClass("current"),i.addClass("current"),a.currentGridFilters.builder=r,a.currentGridFilters.page=1,a.loadSitesGrid(!0))},clickCategoryFilter:function(t){t.preventDefault();var i=s(this),e=s(".suki-sites-import-categories-filter a"),r=s(".wp-filter-search"),n=parseInt(i.attr("data-id"));i.hasClass("current")||(e.removeClass("current"),i.addClass("current"),r.val(""),delete a.currentGridFilters.search,-1===n?delete a.currentGridFilters.category:a.currentGridFilters.category=n,a.currentGridFilters.page=1,void 0!==a.currentGridFilters.builder&&a.loadSitesGrid(!0))},submitSearchFilter:function(t){t.preventDefault();var i=s(this),e=s(".suki-sites-import-categories-filter a"),r=i.val();0<r.length?(e.removeClass("current"),a.currentGridFilters.search=r):(e.filter('[data-id="-1"]').addClass("current"),delete a.currentGridFilters.search),delete a.currentGridFilters.category,a.currentGridFilters.page=1,void 0!==a.currentGridFilters.builder&&a.loadSitesGrid(!0)},clickLoadMore:function(t){t.preventDefault(),a.currentGridFilters.page=a.currentGridFilters.page+1,a.$browser.find(".suki-sites-load-more").remove(),a.loadSitesGrid()},openSitePreview:function(t){t.preventDefault();var i=s(this).closest(".theme"),e=JSON.parse(i.attr("data-info"));switch(a.$currentPreview=s(a.templates.preview(e)),a.$container.append(a.$currentPreview),a.currentPreviewInfo=e,a.currentPreviewInfo.import_status=null,a.currentPreviewInfo.status){case"require_higher_license_plan":a.changeActionButtonStatus("upgrade_required");break;default:if(0<a.currentPreviewInfo.required_plugins.length){s.ajax({method:"POST",url:ajaxurl+"?do=suki_sites_import__get_plugins_status",cache:!1,data:{action:"suki_sites_import__get_plugins_status",plugins:e.required_plugins,_ajax_nonce:SukiSitesImportScriptsData.ajax_nonce}}).done(function(t,i,e){t.success?s.each(t.data,function(t,i){a.changePluginButtonStatus(a.currentPreviewInfo.required_plugins[t],i)}):alert(SukiSitesImportScriptsData.strings.site_error_invalid)})}else a.changeActionButtonStatus("ready_to_import")}},closeSitePreview:function(t){t.preventDefault();var i=!0;-1<["importing_contents","importing_customizer","importing_widgets","importing_options"].indexOf(a.currentPreviewInfo.import_status)&&(confirm(SukiSitesImportScriptsData.strings.confirm_close_importing)||(i=!1)),i&&(a.$currentPreview=null,a.currentPreviewInfo={},s(".suki-sites-import-preview").remove())},clickInstallPlugin:function(t){t.preventDefault();var i=s(this).attr("data-index"),e=a.currentPreviewInfo.required_plugins[i];a.installPlugin(e)},clickActivatePlugin:function(t){t.preventDefault();var i=s(this).attr("data-index"),e=a.currentPreviewInfo.required_plugins[i];a.activatePlugin(e)},clickImport:function(t){t.preventDefault(),a.import()},clickUpgrade:function(t){window.open("https://sukiwp.com/pricing/?utm_source=suki-sites-import&utm_medium=demo-site-preview&utm_campaign=upgrade-license")},clickVisitSite:function(t){t.preventDefault(),window.location=SukiSitesImportScriptsData.home_url},confirmTabClosing:function(t){t.returnValue=""}};s(function(){a.init()})}(jQuery);