!function(t){"use strict";var e={counts:{posts:0,media:0,comments:0,terms:0},completed:{posts:0,media:0,comments:0,terms:0},updateDelta:function(t,e){this.completed[t]+=e;var i=this;requestAnimationFrame((function(){i.render()}))},render:function(){var t=0,e=0;Object.values(this.counts).forEach((function(e,i){t+=e})),Object.values(this.completed).forEach((function(t,i){e+=t}));var r=i.$currentPreview.find(".suki-sites-import-preview-action-button"),n=SukiSitesImportScriptsData.strings.action_importing_contents+" ("+Math.round(e/t*100)+"%)";r.html(n)}},i={currentGridFilters:{},currentPreviewInfo:{},$currentPreview:null,$container:t(".suki-sites-import-wrap"),$filters:t(".suki-sites-import-wrap .wp-filter"),$browser:t(".suki-sites-import-wrap .theme-browser"),$grid:t(".suki-sites-import-wrap .themes"),templates:{selectBuilder:wp.template("suki-sites-import-select-builder"),filters:wp.template("suki-sites-import-filters"),gridItems:wp.template("suki-sites-import-grid-items"),noSiteFound:wp.template("suki-sites-import-no-site-found"),preview:wp.template("suki-sites-import-preview"),loadMore:wp.template("suki-sites-import-load-more")},init:function(){i.initBinds(),i.loadSiteFilters()},initBinds:function(){i.$container.on("click",".wp-filter .suki-sites-import-builders-filter a",i.clickBuilderFilter),i.$container.on("click",".wp-filter .suki-sites-import-categories-filter a",i.clickCategoryFilter),i.$container.on("keyup",".wp-filter .wp-filter-search",i.submitSearchFilter),i.$container.on("click",".suki-sites-import-load-more button",i.clickLoadMore),i.$container.on("click",".theme-screenshot, .more-details",i.openSitePreview),i.$container.on("click",".close-full-overlay",i.closeSitePreview),i.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="not_installed"]',i.clickInstallPlugin),i.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="inactive"]',i.clickActivatePlugin),i.$container.on("click",'.suki-sites-import-preview-action-button[data-status="upgrade_required"]',i.clickUpgrade),i.$container.on("click",'.suki-sites-import-preview-action-button[data-status="ready_to_import"]',i.clickImport),i.$container.on("click",'.suki-sites-import-preview-action-button[data-status="finished"]',i.clickVisitSite)},loadSiteFilters:function(){t("body").addClass("loading-content"),t.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"site_filters/",cache:!1}).done((function(e,r,n){i.$filters.append(i.templates.filters(e)),t("body").removeClass("loading-content");var a=i.$filters.find('.suki-sites-import-builders-filter a[data-id="'+SukiSitesImportScriptsData.selected_builder+'"]');0<a.length?(a.addClass("current"),i.currentGridFilters.builder=SukiSitesImportScriptsData.selected_builder,i.currentGridFilters.page=1,i.loadSitesGrid(!0)):i.showBuilderSelector()}))},showBuilderSelector:function(){i.$grid.html(i.templates.selectBuilder())},resetSitesGrid:function(){i.$grid.empty()},loadSitesGrid:function(e){t("body").addClass("loading-content"),e&&i.resetSitesGrid();var r=t.extend({builder:null,category:null,search:null,page:1,per_page:15,license_key:SukiSitesImportScriptsData.license_key},i.currentGridFilters);SukiSitesImportScriptsData.dev_mode&&(r.dev_mode=1),0<(n=i.$container.find(".suki-sites-import-load-more")).length&&n.remove();var n,a="";t.each(r,(function(t,e){null!==e&&""!==e&&(a+="&"+t+"="+e)})),a=a.replace("&","?"),0<(n=i.$browser.find(".suki-sites-load-more")).length&&n.remove(),t.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+a,cache:!1}).done((function(r,n,a){i.$grid.append(i.templates.gridItems(r)),0<r.length?i.$browser.append(i.templates.loadMore()):e&&i.$grid.append(i.templates.noSiteFound()),t("body").removeClass("loading-content")}))},changePluginButtonStatus:function(t,e){t.status=e;var r,n,a=i.$currentPreview.find('.suki-sites-import-preview-required-plugin-button[data-slug="'+t.slug+'"]'),s=SukiSitesImportScriptsData.strings["plugin_"+e];switch(e){case"not_installed":case"inactive":r=!1,n="button-secondary";break;case"installing":case"activating":r=!0,n="button-secondary installing disabled";break;case"active":r=!0,n="button-link updated-message disabled"}a.html(s),a.prop("disabled",r),a.removeClass("button-primary button-secondary button-link installing updated-message disabled"),a.addClass(n),a.attr("data-status",e),i.isReadyToImport()?i.changeActionButtonStatus("ready_to_import"):i.changeActionButtonStatus("plugins_not_active")},isReadyToImport:function(){var e=!0;return t.each(i.currentPreviewInfo.required_plugins,(function(t,i){e=e&&"active"===i.status})),e},changeActionButtonStatus:function(t){i.currentPreviewInfo.import_status=t;var e,r,n=i.$currentPreview.find(".suki-sites-import-preview-action-button"),a=SukiSitesImportScriptsData.strings["action_"+t];switch(t){case"upgrade_required":e=!1,r="button-secondary";break;case"plugins_not_active":case"action_finished":e=!0,r="button-secondary disabled";break;case"ready_to_import":e=!1,r="button-primary";break;case"preparing_resources":case"preparing_contents":case"importing_contents":case"importing_customizer":case"importing_widgets":case"importing_options":case"finalizing_import":e=!0,r="button-secondary installing disabled";break;case"finished":e=!1,r="button-primary updated-message"}n.html(a),n.prop("disabled",e),n.removeClass("button-primary button-secondary button-link installing updated-message disabled"),n.addClass(r),n.attr("data-status",t)},installPlugin:function(e){if("not_installed"===e.status){var r="Installing plugin: "+e.name;console.log(r);var n=i.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+e.slug+'"]');return n.prop("disabled",!0),i.changePluginButtonStatus(e,"installing"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__install_plugin",cache:!1,data:{action:"suki_sites_import__install_plugin",plugin_slug:e.slug,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,a){t.success?(i.changePluginButtonStatus(e,"inactive"),n.prop("disabled",!1),i.activatePlugin(e)):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)}))}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},activatePlugin:function(e){if("inactive"===e.status){var r="Activating plugin: "+e.name;console.log(r);var n=i.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+e.slug+'"]');return n.prop("disabled",!0),i.changePluginButtonStatus(e,"activating"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__activate_plugin",cache:!1,data:{action:"suki_sites_import__activate_plugin",plugin_path:e.path,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,a){t.success?(n.prop("disabled",!1),i.changePluginButtonStatus(e,"active")):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)}))}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},import:function(){if(confirm(SukiSitesImportScriptsData.strings.confirm_import))if(i.isReadyToImport()){var e="Fetching site data for last validation.";console.log(e),i.changeActionButtonStatus("validating_data"),window.addEventListener("beforeunload",i.confirmTabClosing);var r=t.extend({license_key:SukiSitesImportScriptsData.license_key},i.currentGridFilters);SukiSitesImportScriptsData.dev_mode&&(r.dev_mode=1);var n="";t.each(r,(function(t,e){null!==e&&""!==e&&(n+="&"+t+"="+e)})),n=n.replace("&","?"),t.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+i.currentPreviewInfo.id+"/"+n,cache:!1}).done((function(t,r,n){r?i.preparingImport():alert("Error: "+e+"\n"+t.data)}))}else alert(SukiSitesImportScriptsData.strings.import_error_invalid)},preparingImport:function(){var e="Preparing import";console.log(e),i.changeActionButtonStatus("preparing_import"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__prepare_import",cache:!1,data:{action:"suki_sites_import__prepare_import",info:{slug:i.currentPreviewInfo.slug,required_plugins:i.currentPreviewInfo.required_plugins,required_pro_modules:i.currentPreviewInfo.required_pro_modules,contents_xml_file_url:i.currentPreviewInfo.contents_xml_file_url,customizer_json_file_url:i.currentPreviewInfo.customizer_json_file_url,widgets_json_file_url:i.currentPreviewInfo.widgets_json_file_url,options_json_file_url:i.currentPreviewInfo.options_json_file_url},_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){r?i.importContents():alert("Error: "+e+"\n"+t.data)}))},importContents:function(){console.log("Preparing Contents XML file"),i.changeActionButtonStatus("importing_contents"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__prepare_contents",cache:!1,data:{action:"suki_sites_import__prepare_contents",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){if(t.success){var a="Importing content and media files";console.log(a);var s=new EventSource(ajaxurl+"?action=suki_sites_import__import_contents&_ajax_nonce="+SukiSitesImportScriptsData.nonce);s.addEventListener("message",(function(t){var r=JSON.parse(t.data);switch(r.action){case"setCounts":e.counts=r.counts,e.render();break;case"updateDelta":e.updateDelta(r.type,r.delta);break;case"complete":s.close(),!1===r.error?i.importCustomizer():alert("Error: "+a+"\n"+r.error)}}),!1),s.addEventListener("error",(function(t){s.close(),alert("Error: "+a)}),!1)}else alert("Error: "+a+"\n"+t.data)}))},importCustomizer:function(){var e="Importing customizer settings";console.log(e),i.changeActionButtonStatus("importing_customizer"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_customizer",cache:!1,data:{action:"suki_sites_import__import_customizer",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){t.success?i.importWidgets():alert("Error: "+e+"\n"+t.data)}))},importWidgets:function(){var e="Importing widgets";console.log(e),i.changeActionButtonStatus("importing_widgets"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_widgets",cache:!1,data:{action:"suki_sites_import__import_widgets",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){t.success?i.importOptions():alert("Error: "+e+"\n"+t.data)}))},importOptions:function(){var e="Importing other options";console.log(e),i.changeActionButtonStatus("importing_options"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_options",cache:!1,data:{action:"suki_sites_import__import_options",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){t.success?i.finalizeImport():alert("Error: "+e+"\n"+t.data)}))},finalizeImport:function(){var e="Finalizing import";console.log(e),i.changeActionButtonStatus("finalizing_import"),t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__finalize_import",cache:!1,data:{action:"suki_sites_import__finalize_import",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,r,n){t.success?(i.changeActionButtonStatus("finished"),window.removeEventListener("beforeunload",i.confirmTabClosing)):alert("Error: "+e+"\n"+t.data)}))},clickBuilderFilter:function(e){e.preventDefault();var r=t(this),n=t(".suki-sites-import-builders-filter a"),a=parseInt(r.attr("data-id"));r.hasClass("current")||(n.removeClass("current"),r.addClass("current"),i.currentGridFilters.builder=a,i.currentGridFilters.page=1,t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__select_builder",cache:!1,data:{action:"suki_sites_import__select_builder",builder:a,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(t,e,i){t.success||alert("Error: "+log+"\n"+t.data)})),i.loadSitesGrid(!0))},clickCategoryFilter:function(e){e.preventDefault();var r=t(this),n=t(".suki-sites-import-categories-filter a"),a=t(".wp-filter-search"),s=parseInt(r.attr("data-id"));r.hasClass("current")||(n.removeClass("current"),r.addClass("current"),a.val(""),delete i.currentGridFilters.search,-1===s?delete i.currentGridFilters.category:i.currentGridFilters.category=s,i.currentGridFilters.page=1,void 0!==i.currentGridFilters.builder&&i.loadSitesGrid(!0))},submitSearchFilter:function(e){e.preventDefault();var r=t(this),n=t(".suki-sites-import-categories-filter a"),a=r.val();0<a.length?(n.removeClass("current"),i.currentGridFilters.search=a):(n.filter('[data-id="-1"]').addClass("current"),delete i.currentGridFilters.search),delete i.currentGridFilters.category,i.currentGridFilters.page=1,void 0!==i.currentGridFilters.builder&&i.loadSitesGrid(!0)},clickLoadMore:function(t){t.preventDefault(),i.currentGridFilters.page=i.currentGridFilters.page+1,i.$browser.find(".suki-sites-load-more").remove(),i.loadSitesGrid()},openSitePreview:function(e){e.preventDefault();var r=t(this).closest(".theme"),n=JSON.parse(r.attr("data-info"));switch(i.$currentPreview=t(i.templates.preview(n)),i.$container.append(i.$currentPreview),i.currentPreviewInfo=n,i.currentPreviewInfo.import_status=null,i.currentPreviewInfo.status){case"require_higher_license_plan":i.changeActionButtonStatus("upgrade_required");break;default:if(0<i.currentPreviewInfo.required_plugins.length){t.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__get_plugins_status",cache:!1,data:{action:"suki_sites_import__get_plugins_status",plugins:n.required_plugins,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done((function(e,r,n){e.success?t.each(e.data,(function(t,e){i.changePluginButtonStatus(i.currentPreviewInfo.required_plugins[t],e)})):alert(SukiSitesImportScriptsData.strings.site_error_invalid)}))}else i.changeActionButtonStatus("ready_to_import")}},closeSitePreview:function(e){e.preventDefault();var r=!0;-1<["preparing_import","preparing_contents","importing_contents","importing_customizer","importing_widgets","importing_options"].indexOf(i.currentPreviewInfo.import_status)&&(confirm(SukiSitesImportScriptsData.strings.confirm_close_importing)||(r=!1)),r&&(i.$currentPreview=null,i.currentPreviewInfo={},t(".suki-sites-import-preview").remove())},clickInstallPlugin:function(e){e.preventDefault();var r=t(this).attr("data-index"),n=i.currentPreviewInfo.required_plugins[r];i.installPlugin(n)},clickActivatePlugin:function(e){e.preventDefault();var r=t(this).attr("data-index"),n=i.currentPreviewInfo.required_plugins[r];i.activatePlugin(n)},clickImport:function(t){t.preventDefault(),i.import()},clickUpgrade:function(t){window.open("https://sukiwp.com/pricing/?utm_source=suki-sites-import&utm_medium=demo-site-preview&utm_campaign=upgrade-license")},clickVisitSite:function(t){t.preventDefault(),window.location=SukiSitesImportScriptsData.home_url},confirmTabClosing:function(t){t.returnValue=""}};t((function(){i.init()}))}(jQuery);