!function(a){"use strict";var s={counts:{posts:0,media:0,comments:0,terms:0},completed:{posts:0,media:0,comments:0,terms:0},updateDelta:function(t,e){this.completed[t]+=e;var i=this;requestAnimationFrame(function(){i.render()})},render:function(){var i=0,r=0;Object.values(this.counts).forEach(function(t,e){i+=t}),Object.values(this.completed).forEach(function(t,e){r+=t});var t=o.$currentPreview.find(".suki-sites-import-preview-action-button"),e=SukiSitesImportScriptsData.strings.action_importing_contents+" ("+Math.round(r/i*100)+"%)";t.html(e)}},o={currentGridFilters:{},currentPreviewInfo:{},$currentPreview:null,$container:a(".suki-sites-import-wrap"),$filters:a(".suki-sites-import-wrap .wp-filter"),$browser:a(".suki-sites-import-wrap .theme-browser"),$grid:a(".suki-sites-import-wrap .themes"),templates:{selectBuilder:wp.template("suki-sites-import-select-builder"),filters:wp.template("suki-sites-import-filters"),gridItems:wp.template("suki-sites-import-grid-items"),noSiteFound:wp.template("suki-sites-import-no-site-found"),preview:wp.template("suki-sites-import-preview"),loadMore:wp.template("suki-sites-import-load-more")},init:function(){o.initBinds(),o.loadSiteFilters()},initBinds:function(){o.$container.on("click",".wp-filter .suki-sites-import-builders-filter a",o.clickBuilderFilter),o.$container.on("click",".wp-filter .suki-sites-import-categories-filter a",o.clickCategoryFilter),o.$container.on("keyup",".wp-filter .wp-filter-search",o.submitSearchFilter),o.$container.on("click",".suki-sites-import-load-more button",o.clickLoadMore),o.$container.on("click",".theme-screenshot, .more-details",o.openSitePreview),o.$container.on("click",".close-full-overlay",o.closeSitePreview),o.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="not_installed"]',o.clickInstallPlugin),o.$container.on("click",'.suki-sites-import-preview-required-plugin-button[data-status="inactive"]',o.clickActivatePlugin),o.$container.on("click",'.suki-sites-import-preview-action-button[data-status="upgrade_required"]',o.clickUpgrade),o.$container.on("click",'.suki-sites-import-preview-action-button[data-status="ready_to_import"]',o.clickImport),o.$container.on("click",'.suki-sites-import-preview-action-button[data-status="finished"]',o.clickVisitSite)},loadSiteFilters:function(){a("body").addClass("loading-content"),a.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"site_filters/",cache:!1}).done(function(t,e,i){o.$filters.append(o.templates.filters(t)),a("body").removeClass("loading-content");var r=o.$filters.find('.suki-sites-import-builders-filter a[data-id="'+SukiSitesImportScriptsData.selected_builder+'"]');0<r.length?(r.addClass("current"),o.currentGridFilters.builder=SukiSitesImportScriptsData.selected_builder,o.currentGridFilters.page=1,o.loadSitesGrid(!0)):o.showBuilderSelector()})},showBuilderSelector:function(){o.$grid.html(o.templates.selectBuilder())},resetSitesGrid:function(){o.$grid.empty()},loadSitesGrid:function(r){a("body").addClass("loading-content"),r&&o.resetSitesGrid();var t=a.extend({builder:null,category:null,search:null,page:1,per_page:15,license_key:SukiSitesImportScriptsData.license_key},o.currentGridFilters);SukiSitesImportScriptsData.dev_mode&&(t.dev_mode=1),0<(e=o.$container.find(".suki-sites-import-load-more")).length&&e.remove();var e,i="";a.each(t,function(t,e){null!==e&&""!==e&&(i+="&"+t+"="+e)}),i=i.replace("&","?"),0<(e=o.$browser.find(".suki-sites-load-more")).length&&e.remove(),a.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+i,cache:!1}).done(function(t,e,i){o.$grid.append(o.templates.gridItems(t)),0<t.length?o.$browser.append(o.templates.loadMore()):r&&o.$grid.append(o.templates.noSiteFound()),a("body").removeClass("loading-content")})},changePluginButtonStatus:function(t,e){t.status=e;var i,r,n=o.$currentPreview.find('.suki-sites-import-preview-required-plugin-button[data-slug="'+t.slug+'"]'),a=SukiSitesImportScriptsData.strings["plugin_"+e];switch(e){case"not_installed":case"inactive":i=!1,r="button-secondary";break;case"installing":case"activating":i=!0,r="button-secondary installing disabled";break;case"active":i=!0,r="button-link updated-message disabled"}n.html(a),n.prop("disabled",i),n.removeClass("button-primary button-secondary button-link installing updated-message disabled"),n.addClass(r),n.attr("data-status",e),o.isReadyToImport()?o.changeActionButtonStatus("ready_to_import"):o.changeActionButtonStatus("plugins_not_active")},isReadyToImport:function(){var i=!0;return a.each(o.currentPreviewInfo.required_plugins,function(t,e){i=i&&"active"===e.status}),i},changeActionButtonStatus:function(t){o.currentPreviewInfo.import_status=t;var e,i,r=o.$currentPreview.find(".suki-sites-import-preview-action-button"),n=SukiSitesImportScriptsData.strings["action_"+t];switch(t){case"upgrade_required":e=!1,i="button-secondary";break;case"plugins_not_active":case"action_finished":e=!0,i="button-secondary disabled";break;case"ready_to_import":e=!1,i="button-primary";break;case"preparing_resources":case"preparing_contents":case"importing_contents":case"importing_customizer":case"importing_widgets":case"importing_options":case"finalizing_import":e=!0,i="button-secondary installing disabled";break;case"finished":e=!1,i="button-primary updated-message"}r.html(n),r.prop("disabled",e),r.removeClass("button-primary button-secondary button-link installing updated-message disabled"),r.addClass(i),r.attr("data-status",t)},installPlugin:function(r){if("not_installed"===r.status){var t="Installing plugin: "+r.name;console.log(t);var n=o.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),o.changePluginButtonStatus(r,"installing"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__install_plugin",cache:!1,data:{action:"suki_sites_import__install_plugin",plugin_slug:r.slug,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?(o.changePluginButtonStatus(r,"inactive"),n.prop("disabled",!1),o.activatePlugin(r)):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},activatePlugin:function(r){if("inactive"===r.status){var t="Activating plugin: "+r.name;console.log(t);var n=o.$currentPreview.find(".suki-sites-import-preview-required-plugin-button").not('[data-slug="'+r.slug+'"]');return n.prop("disabled",!0),o.changePluginButtonStatus(r,"activating"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__activate_plugin",cache:!1,data:{action:"suki_sites_import__activate_plugin",plugin_path:r.path,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?(n.prop("disabled",!1),o.changePluginButtonStatus(r,"active")):alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)})}alert(SukiSitesImportScriptsData.strings.plugin_error_invalid)},import:function(){if(confirm(SukiSitesImportScriptsData.strings.confirm_import))if(o.isReadyToImport()){var r="Fetching site data for last validation.";console.log(r),o.changeActionButtonStatus("validating_data"),window.addEventListener("beforeunload",o.confirmTabClosing);var t=a.extend({license_key:SukiSitesImportScriptsData.license_key},o.currentGridFilters);SukiSitesImportScriptsData.dev_mode&&(t.dev_mode=1);var i="";a.each(t,function(t,e){null!==e&&""!==e&&(i+="&"+t+"="+e)}),i=i.replace("&","?"),a.ajax({method:"GET",dataType:"JSON",url:SukiSitesImportScriptsData.api_url+"sites/"+o.currentPreviewInfo.id+"/"+i,cache:!1}).done(function(t,e,i){e?o.preparingImport():alert("Error: "+r+"\n"+t.data)})}else alert(SukiSitesImportScriptsData.strings.import_error_invalid)},preparingImport:function(){var r="Preparing import";console.log(r),o.changeActionButtonStatus("preparing_import"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__prepare_import",cache:!1,data:{action:"suki_sites_import__prepare_import",info:{slug:o.currentPreviewInfo.slug,required_plugins:o.currentPreviewInfo.required_plugins,required_pro_modules:o.currentPreviewInfo.required_pro_modules,contents_xml_file_url:o.currentPreviewInfo.contents_xml_file_url,customizer_json_file_url:o.currentPreviewInfo.customizer_json_file_url,widgets_json_file_url:o.currentPreviewInfo.widgets_json_file_url,options_json_file_url:o.currentPreviewInfo.options_json_file_url},_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){e?o.importContents():alert("Error: "+r+"\n"+t.data)})},importContents:function(){console.log("Preparing Contents XML file"),o.changeActionButtonStatus("importing_contents"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__prepare_contents",cache:!1,data:{action:"suki_sites_import__prepare_contents",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){if(t.success){var r="Importing content and media files";console.log(r);var n=new EventSource(ajaxurl+"?action=suki_sites_import__import_contents&_ajax_nonce="+SukiSitesImportScriptsData.nonce);n.addEventListener("message",function(t){var e=JSON.parse(t.data);switch(e.action){case"setCounts":s.counts=e.counts,s.render();break;case"updateDelta":s.updateDelta(e.type,e.delta);break;case"complete":n.close(),!1===e.error?o.importCustomizer():alert("Error: "+r+"\n"+e.error)}},!1),n.addEventListener("error",function(t){n.close(),alert("Error: "+r)},!1)}else alert("Error: "+r+"\n"+t.data)})},importCustomizer:function(){var r="Importing customizer settings";console.log(r),o.changeActionButtonStatus("importing_customizer"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_customizer",cache:!1,data:{action:"suki_sites_import__import_customizer",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?o.importWidgets():alert("Error: "+r+"\n"+t.data)})},importWidgets:function(){var r="Importing widgets";console.log(r),o.changeActionButtonStatus("importing_widgets"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_widgets",cache:!1,data:{action:"suki_sites_import__import_widgets",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?o.importOptions():alert("Error: "+r+"\n"+t.data)})},importOptions:function(){var r="Importing other options";console.log(r),o.changeActionButtonStatus("importing_options"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__import_options",cache:!1,data:{action:"suki_sites_import__import_options",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?o.finalizeImport():alert("Error: "+r+"\n"+t.data)})},finalizeImport:function(){var r="Finalizing import";console.log(r),o.changeActionButtonStatus("finalizing_import"),a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__finalize_import",cache:!1,data:{action:"suki_sites_import__finalize_import",_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?(o.changeActionButtonStatus("finished"),window.removeEventListener("beforeunload",o.confirmTabClosing)):alert("Error: "+r+"\n"+t.data)})},clickBuilderFilter:function(t){t.preventDefault();var e=a(this),i=a(".suki-sites-import-builders-filter a"),r=parseInt(e.attr("data-id"));e.hasClass("current")||(i.removeClass("current"),e.addClass("current"),o.currentGridFilters.builder=r,o.currentGridFilters.page=1,a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__select_builder",cache:!1,data:{action:"suki_sites_import__select_builder",builder:r,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success||alert("Error: "+log+"\n"+t.data)}),o.loadSitesGrid(!0))},clickCategoryFilter:function(t){t.preventDefault();var e=a(this),i=a(".suki-sites-import-categories-filter a"),r=a(".wp-filter-search"),n=parseInt(e.attr("data-id"));e.hasClass("current")||(i.removeClass("current"),e.addClass("current"),r.val(""),delete o.currentGridFilters.search,-1===n?delete o.currentGridFilters.category:o.currentGridFilters.category=n,o.currentGridFilters.page=1,void 0!==o.currentGridFilters.builder&&o.loadSitesGrid(!0))},submitSearchFilter:function(t){t.preventDefault();var e=a(this),i=a(".suki-sites-import-categories-filter a"),r=e.val();0<r.length?(i.removeClass("current"),o.currentGridFilters.search=r):(i.filter('[data-id="-1"]').addClass("current"),delete o.currentGridFilters.search),delete o.currentGridFilters.category,o.currentGridFilters.page=1,void 0!==o.currentGridFilters.builder&&o.loadSitesGrid(!0)},clickLoadMore:function(t){t.preventDefault(),o.currentGridFilters.page=o.currentGridFilters.page+1,o.$browser.find(".suki-sites-load-more").remove(),o.loadSitesGrid()},openSitePreview:function(t){t.preventDefault();var e=a(this).closest(".theme"),i=JSON.parse(e.attr("data-info"));switch(o.$currentPreview=a(o.templates.preview(i)),o.$container.append(o.$currentPreview),o.currentPreviewInfo=i,o.currentPreviewInfo.import_status=null,o.currentPreviewInfo.status){case"require_higher_license_plan":o.changeActionButtonStatus("upgrade_required");break;default:if(0<o.currentPreviewInfo.required_plugins.length){a.ajax({method:"POST",dataType:"JSON",url:ajaxurl+"?do=suki_sites_import__get_plugins_status",cache:!1,data:{action:"suki_sites_import__get_plugins_status",plugins:i.required_plugins,_ajax_nonce:SukiSitesImportScriptsData.nonce}}).done(function(t,e,i){t.success?a.each(t.data,function(t,e){o.changePluginButtonStatus(o.currentPreviewInfo.required_plugins[t],e)}):alert(SukiSitesImportScriptsData.strings.site_error_invalid)})}else o.changeActionButtonStatus("ready_to_import")}},closeSitePreview:function(t){t.preventDefault();var e=!0;-1<["preparing_import","preparing_contents","importing_contents","importing_customizer","importing_widgets","importing_options"].indexOf(o.currentPreviewInfo.import_status)&&(confirm(SukiSitesImportScriptsData.strings.confirm_close_importing)||(e=!1)),e&&(o.$currentPreview=null,o.currentPreviewInfo={},a(".suki-sites-import-preview").remove())},clickInstallPlugin:function(t){t.preventDefault();var e=a(this).attr("data-index"),i=o.currentPreviewInfo.required_plugins[e];o.installPlugin(i)},clickActivatePlugin:function(t){t.preventDefault();var e=a(this).attr("data-index"),i=o.currentPreviewInfo.required_plugins[e];o.activatePlugin(i)},clickImport:function(t){t.preventDefault(),o.import()},clickUpgrade:function(t){window.open("https://sukiwp.com/pricing/?utm_source=suki-sites-import&utm_medium=demo-site-preview&utm_campaign=upgrade-license")},clickVisitSite:function(t){t.preventDefault(),window.location=SukiSitesImportScriptsData.home_url},confirmTabClosing:function(t){t.returnValue=""}};a(function(){o.init()})}(jQuery);